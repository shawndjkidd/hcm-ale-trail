<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HCM Ale Trail</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { margin: 0; padding: 0; background-color: #dc2626; }
        html, body { overflow-x: hidden; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
const e = React.createElement;
const { useState, useEffect } = React;

// ============================================
// GOOGLE SHEETS CONFIG
// ============================================
const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbwqPRXw7iknhejI-1D4eiTQGslIL83LkmV4x2jq-E0UvZnA_7HM7D1N5CAP3xJM33KfmA/exec';
// ============================================

const block = { fontFamily: 'Impact, Haettenschweiler, "Arial Black", sans-serif', fontWeight: 900, letterSpacing: '0.5px', textTransform: 'uppercase' };
const breweryBlock = { ...block, letterSpacing: '1px', lineHeight: '0.95' };

const Instagram = ({size=24}) => e('svg', {width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}, e('rect',{x:"2",y:"2",width:"20",height:"20",rx:"5",ry:"5"}), e('path',{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"}), e('line',{x1:"17.5",y1:"6.5",x2:"17.51",y2:"6.5"}));
const Facebook = ({size=24}) => e('svg', {width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}, e('path',{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"}));
const Messenger = ({size=24}) => e('svg', {width:size,height:size,viewBox:"0 0 24 24",fill:"currentColor"}, e('path',{d:"M12 2C6.36 2 2 6.13 2 11.7c0 2.91 1.19 5.44 3.14 7.17.16.13.26.35.27.57l.05 1.78c.04.57.61.94 1.13.71l1.98-.87c.17-.08.36-.1.55-.06.91.25 1.87.38 2.88.38 5.64 0 10-4.13 10-9.7C22 6.13 17.64 2 12 2zm5.89 7.58l-2.89 4.58c-.45.73-1.44.91-2.13.39l-2.3-1.72a.6.6 0 0 0-.72 0l-3.1 2.36c-.41.32-.96-.17-.68-.61l2.89-4.58c.45-.73 1.44-.91 2.13-.39l2.3 1.72a.6.6 0 0 0 .72 0l3.1-2.36c.41-.32.96.17.68.61z"}));
const Copy = ({size=24}) => e('svg', {width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}, e('rect',{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}), e('path',{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"}));
const MapPin = ({size=24}) => e('svg', {width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}, e('path',{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}), e('circle',{cx:"12",cy:"10",r:"3"}));
const Star = ({size=24,filled=false}) => e('svg', {width:size,height:size,viewBox:"0 0 24 24",fill:filled?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}, e('polygon',{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}));
const Beer = ({size=24}) => e('svg', {width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}, e('path',{d:"M17 11h1a3 3 0 0 1 0 6h-1"}), e('path',{d:"M9 12v6"}), e('path',{d:"M13 12v6"}), e('path',{d:"M14 7.5c-1 0-1.44.5-3 .5s-2-.5-3-.5-1.72.5-2.5.5a2.5 2.5 0 0 1 0-5c.78 0 1.57.5 2.5.5S9.44 2.5 11 2.5s2 .5 3 .5 1.72-.5 2.5-.5a2.5 2.5 0 0 1 0 5c-.78 0-1.5-.5-2.5-.5Z"}), e('path',{d:"M5 8v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8"}));

function App() {
  const [stamps, setStamps] = useState(() => {
    try { return JSON.parse(localStorage.getItem('aletrail_stamps')) || []; } catch { return []; }
  });
  const [beerLogs, setBeerLogs] = useState(() => {
    try { return JSON.parse(localStorage.getItem('aletrail_beerlogs')) || []; } catch { return []; }
  });
  const [userInfo, setUserInfo] = useState(() => {
    try { return JSON.parse(localStorage.getItem('aletrail_user')) || null; } catch { return null; }
  });
  const [selected, setSelected] = useState(null);
  const [lang, setLang] = useState('en');
  const [code, setCode] = useState('');
  const [error, setError] = useState('');
  const [showFaq, setShowFaq] = useState(false);
  const [showQR, setShowQR] = useState(false);
  const [showBeerLog, setShowBeerLog] = useState(false);
  const [showMyBeers, setShowMyBeers] = useState(false);
  const [showCompletion, setShowCompletion] = useState(false);
  const [showSaveProgress, setShowSaveProgress] = useState(false);
  const [saveEmail, setSaveEmail] = useState('');
  const [saveSent, setSaveSent] = useState(false);
  const [copied, setCopied] = useState(false);
  const [autoStamped, setAutoStamped] = useState(false);
  
  // Beer log form state
  const [beerName, setBeerName] = useState('');
  const [beerRating, setBeerRating] = useState(0);
  const [beerNotes, setBeerNotes] = useState('');
  
  // Completion form state
  const [completionName, setCompletionName] = useState('');
  const [completionEmail, setCompletionEmail] = useState('');
  const [completionPhone, setCompletionPhone] = useState('');
  const [completionSubmitted, setCompletionSubmitted] = useState(false);

  useEffect(() => {
    localStorage.setItem('aletrail_stamps', JSON.stringify(stamps));
  }, [stamps]);

  useEffect(() => {
    localStorage.setItem('aletrail_beerlogs', JSON.stringify(beerLogs));
  }, [beerLogs]);

  useEffect(() => {
    localStorage.setItem('aletrail_user', JSON.stringify(userInfo));
  }, [userInfo]);

  useEffect(() => {
    const params = new URLSearchParams(window.location.search);
    const stampId = parseInt(params.get('stamp'));
    const stampCode = params.get('code');
    if (stampId && stampCode && codes[stampId] === stampCode.toUpperCase()) {
      if (!stamps.includes(stampId)) {
        const newStamps = [...stamps, stampId];
        setStamps(newStamps);
        setAutoStamped(true);
        const b = breweries.find(x => x.id === stampId);
        if (b) {
          setSelected(b);
          // Log stamp collection to Google Sheets
          sendToSheets({
            type: 'stamp',
            brewery: b.name,
            breweryId: b.id,
            method: 'QR',
            stampCount: newStamps.length
          });
        }
        // Check if this completes the trail
        if (newStamps.length === 8 && !userInfo?.completed) {
          setTimeout(() => setShowCompletion(true), 1500);
        }
      }
      window.history.replaceState({}, '', window.location.pathname);
    }
  }, []);

  const links = { 
    website: 'https://www.hochiminhaletrail.com/', 
    maps: 'https://www.google.com/maps/d/u/1/viewer?usp=sharing&mid=1ZO-30TD2syibuwwqGF7wDxwHACOEsBQ', 
    ig: 'https://www.instagram.com/hcm.aletrail/', 
    msg: 'https://m.me/HoChiMinhAleTrail'
  };
  
  const codes = { 1:'BIACRAFT2024', 2:'DARKNESS2024', 3:'DEME2024', 4:'STEERSMAN2024', 5:'EASTWEST2024', 6:'ROOSTER2024', 7:'BRIDGES2024', 8:'BELGO2024' };
  
  // FULL TRANSLATIONS
  const txt = {
    en: { 
      stamps:"STAMPS", done:"DONE!", go:"GO!", code:"CODE", web:"WEBSITE", maps:"MAPS", faq:"FAQ", 
      how:"HOW TO PLAY", s1:"GO TO ANY BREWERY", s2:"BUY BEER & GET:", s2a:"QR CODE", s2b:"OR SECRET CODE", 
      s3:"GET STAMP!", s4:"8 STAMPS = FREE HAT!", rush:"NO RUSH!", scan:"SCAN QR", ask:"ASK FOR QR!", 
      ok:"OK!", nope:"NOPE!", copy:"Â© 2024 HCM ALE TRAIL", copyTag:"COPY", copied:"COPIED!", 
      directions:"DIRECTIONS", myBeers:"MY BEERS", addBeer:"ADD BEER", beerName:"BEER NAME",
      rating:"RATING", notes:"NOTES (OPTIONAL)", save:"SAVE", cancel:"CANCEL", noBeer:"NO BEERS LOGGED YET",
      complete:"CONGRATULATIONS!", completeMsg:"You completed the Ale Trail! Claim your FREE HAT at:",
      name:"NAME", email:"EMAIL", phone:"PHONE", submit:"SUBMIT", thanks:"THANKS!",
      collectHat:"Show this screen to collect your hat!", beersAt:"Beers at",
      welcome:"Welcome to the HCM Ale Trail! Visit 8 awesome taprooms across Saigon. Buy a drink, collect a stamp, and get a free Ale Trail hat at your last stop! No deadline â€” do it in a day or a year.",
      tips:"KEEP YOUR STAMPS", tip1:"Always use the same browser (Safari OR Chrome, not both)", tip2:"Don't use Private/Incognito mode", tip3:"Don't clear browser data until you finish!",
      saveProgress:"SAVE PROGRESS", saveDesc:"Email yourself a recovery link", emailPlaceholder:"Enter your email", sendLink:"SEND RECOVERY LINK", linkSent:"CHECK YOUR EMAIL!", linkCopied:"LINK COPIED!",
      tag1: "Funky names, creative food, and the OG craft beer hangout.",
      tag2: "Bold beers, bold branding. Known for IPAs, stouts, and indie taproom vibe.",
      tag3: "Underground feel with clean, small-batch brews. A local hidden gem.",
      tag4: "Approachable beers and chill vibes. Great for groups and newcomers.",
      tag5: "Sleek brewhouse with bold beers, food, and rooftop. Award-winning!",
      tag6: "Casual and affordable with clean styles. Great for local vibes.",
      tag7: "Born in Da Nang, focused on sustainability. Always something new!",
      tag8: "Rich Belgian-style beers in a medieval space. Perfect for big pours."
    },
    vi: { 
      stamps:"TEM", done:"XONG!", go:"OK!", code:"MÃƒ", web:"WEBSITE", maps:"Báº¢N Äá»’", faq:"FAQ", 
      how:"CÃCH CHÆ I", s1:"Äáº¾N QUÃN BIA", s2:"MUA BIA & Láº¤Y:", s2a:"MÃƒ QR", s2b:"HOáº¶C MÃƒ Sá»", 
      s3:"NHáº¬N TEM!", s4:"8 TEM = MÅ¨ FREE!", rush:"Tá»ª Tá»ª!", scan:"QUÃ‰T QR", ask:"Há»ŽI MÃƒ QR!", 
      ok:"OK!", nope:"SAI!", copy:"Â© 2024 ALE TRAIL", copyTag:"SAO CHÃ‰P", copied:"ÄÃƒ SAO CHÃ‰P!", 
      directions:"CHá»ˆ ÄÆ¯á»œNG", myBeers:"BIA Cá»¦A TÃ”I", addBeer:"THÃŠM BIA", beerName:"TÃŠN BIA",
      rating:"ÄÃNH GIÃ", notes:"GHI CHÃš (TÃ™Y CHá»ŒN)", save:"LÆ¯U", cancel:"Há»¦Y", noBeer:"CHÆ¯A CÃ“ BIA NÃ€O",
      complete:"CHÃšC Má»ªNG!", completeMsg:"Báº¡n Ä‘Ã£ hoÃ n thÃ nh Ale Trail! Nháº­n MÅ¨ MIá»„N PHÃ táº¡i:",
      name:"TÃŠN", email:"EMAIL", phone:"Sá» ÄIá»†N THOáº I", submit:"Gá»¬I", thanks:"Cáº¢M Æ N!",
      collectHat:"Cho nhÃ¢n viÃªn xem mÃ n hÃ¬nh nÃ y Ä‘á»ƒ nháº­n mÅ©!", beersAt:"Bia táº¡i",
      welcome:"ChÃ o má»«ng Ä‘áº¿n HCM Ale Trail! GhÃ© 8 quÃ¡n bia thá»§ cÃ´ng á»Ÿ SÃ i GÃ²n. Mua bia, láº¥y tem, Ä‘á»•i mÅ© miá»…n phÃ­! KhÃ´ng giá»›i háº¡n thá»i gian.",
      tips:"GIá»® TEM Cá»¦A Báº N", tip1:"LuÃ´n dÃ¹ng cÃ¹ng 1 trÃ¬nh duyá»‡t (Safari HOáº¶C Chrome)", tip2:"KhÃ´ng dÃ¹ng cháº¿ Ä‘á»™ áº©n danh", tip3:"KhÃ´ng xÃ³a dá»¯ liá»‡u trÃ¬nh duyá»‡t!",
      saveProgress:"LÆ¯U TIáº¾N TRÃŒNH", saveDesc:"Gá»­i link khÃ´i phá»¥c qua email", emailPlaceholder:"Nháº­p email cá»§a báº¡n", sendLink:"Gá»¬I LINK", linkSent:"KIá»‚M TRA EMAIL!", linkCopied:"ÄÃƒ SAO CHÃ‰P!",
      tag1: "TÃªn Ä‘á»™c Ä‘Ã¡o, Ä‘á»“ Äƒn sÃ¡ng táº¡o, vÃ  quÃ¡n bia thá»§ cÃ´ng Ä‘áº§u tiÃªn cá»§a SÃ i GÃ²n.",
      tag2: "Bia Ä‘áº­m Ä‘Ã , thÆ°Æ¡ng hiá»‡u ná»•i báº­t. Ná»•i tiáº¿ng vá»›i IPA, stout vÃ  khÃ´ng gian indie.",
      tag3: "Phong cÃ¡ch underground vá»›i bia nhá» máº», sáº¡ch. ViÃªn ngá»c áº©n cá»§a Ä‘á»‹a phÆ°Æ¡ng.",
      tag4: "Bia dá»… uá»‘ng vÃ  khÃ´ng gian thÆ° giÃ£n. Tuyá»‡t vá»i cho nhÃ³m vÃ  ngÆ°á»i má»›i.",
      tag5: "NhÃ  mÃ¡y bia sang trá»ng vá»›i bia Ä‘áº­m, Ä‘á»“ Äƒn vÃ  sÃ¢n thÆ°á»£ng. Äáº¡t nhiá»u giáº£i thÆ°á»Ÿng!",
      tag6: "Thoáº£i mÃ¡i vÃ  giÃ¡ cáº£ pháº£i chÄƒng. Tuyá»‡t vá»i cho khÃ´ng khÃ­ Ä‘á»‹a phÆ°Æ¡ng.",
      tag7: "Sinh ra á»Ÿ ÄÃ  Náºµng, táº­p trung vÃ o bá»n vá»¯ng. LuÃ´n cÃ³ Ä‘iá»u má»›i máº»!",
      tag8: "Bia kiá»ƒu Bá»‰ Ä‘áº­m Ä‘Ã  trong khÃ´ng gian trung cá»•. HoÃ n háº£o cho ly lá»›n."
    },
    ko: { 
      stamps:"ìŠ¤íƒ¬í”„", done:"ì™„ë£Œ!", go:"í™•ì¸!", code:"ì½”ë“œ", web:"ì›¹ì‚¬ì´íŠ¸", maps:"ì§€ë„", faq:"FAQ", 
      how:"ì°¸ì—¬ ë°©ë²•", s1:"ì–‘ì¡°ìž¥ ë°©ë¬¸", s2:"ë§¥ì£¼ êµ¬ë§¤ í›„:", s2a:"QR ì½”ë“œ", s2b:"ë˜ëŠ” ë¹„ë°€ì½”ë“œ", 
      s3:"ìŠ¤íƒ¬í”„ ë°›ê¸°!", s4:"8ê°œ = ë¬´ë£Œ ëª¨ìž!", rush:"ì²œì²œížˆ!", scan:"QR ìŠ¤ìº”", ask:"QR ìš”ì²­!", 
      ok:"OK!", nope:"ì˜¤ë¥˜!", copy:"Â© 2024 HCM", copyTag:"ë³µì‚¬", copied:"ë³µì‚¬ë¨!", 
      directions:"ê¸¸ì°¾ê¸°", myBeers:"ë‚´ ë§¥ì£¼", addBeer:"ë§¥ì£¼ ì¶”ê°€", beerName:"ë§¥ì£¼ ì´ë¦„",
      rating:"í‰ì ", notes:"ë©”ëª¨ (ì„ íƒ)", save:"ì €ìž¥", cancel:"ì·¨ì†Œ", noBeer:"ê¸°ë¡ëœ ë§¥ì£¼ ì—†ìŒ",
      complete:"ì¶•í•˜í•©ë‹ˆë‹¤!", completeMsg:"Ale Trail ì™„ë£Œ! ë¬´ë£Œ ëª¨ìžë¥¼ ë°›ìœ¼ì„¸ìš”:",
      name:"ì´ë¦„", email:"ì´ë©”ì¼", phone:"ì „í™”ë²ˆí˜¸", submit:"ì œì¶œ", thanks:"ê°ì‚¬í•©ë‹ˆë‹¤!",
      collectHat:"ì´ í™”ë©´ì„ ë³´ì—¬ì£¼ê³  ëª¨ìžë¥¼ ë°›ìœ¼ì„¸ìš”!", beersAt:"ë§¥ì£¼:",
      welcome:"HCM Ale Trailì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ì‚¬ì´ê³µì˜ 8ê°œ íƒ­ë£¸ì„ ë°©ë¬¸í•˜ì„¸ìš”. ìŒë£Œë¥¼ ì‚¬ê³ , ìŠ¤íƒ¬í”„ë¥¼ ëª¨ìœ¼ê³ , ë§ˆì§€ë§‰ì— ë¬´ë£Œ ëª¨ìžë¥¼ ë°›ìœ¼ì„¸ìš”!",
      tips:"ìŠ¤íƒ¬í”„ ìœ ì§€ íŒ", tip1:"í•­ìƒ ê°™ì€ ë¸Œë¼ìš°ì € ì‚¬ìš© (Safari ë˜ëŠ” Chrome)", tip2:"ì‹œí¬ë¦¿/í”„ë¼ì´ë¹— ëª¨ë“œ ì‚¬ìš© ê¸ˆì§€", tip3:"ì™„ë£Œ ì „ ë¸Œë¼ìš°ì € ë°ì´í„° ì‚­ì œ ê¸ˆì§€!",
      saveProgress:"ì§„í–‰ ì €ìž¥", saveDesc:"ë³µêµ¬ ë§í¬ë¥¼ ì´ë©”ì¼ë¡œ ë°›ê¸°", emailPlaceholder:"ì´ë©”ì¼ ìž…ë ¥", sendLink:"ë§í¬ ì „ì†¡", linkSent:"ì´ë©”ì¼ í™•ì¸!", linkCopied:"ë³µì‚¬ë¨!",
      tag1: "ë…íŠ¹í•œ ì´ë¦„, ì°½ì˜ì ì¸ ìŒì‹, ì˜¤ë¦¬ì§€ë„ í¬ëž˜í”„íŠ¸ ë¹„ì–´ ëª…ì†Œ.",
      tag2: "ëŒ€ë‹´í•œ ë§¥ì£¼, ëŒ€ë‹´í•œ ë¸Œëžœë”©. IPA, ìŠ¤íƒ€ìš°íŠ¸, ì¸ë”” íƒ­ë£¸ ë¶„ìœ„ê¸°ë¡œ ìœ ëª….",
      tag3: "ì–¸ë”ê·¸ë¼ìš´ë“œ ëŠë‚Œì˜ ê¹”ë”í•œ ì†Œê·œëª¨ ì–‘ì¡°ìž¥. ìˆ¨ê²¨ì§„ ë³´ì„.",
      tag4: "ì¹œê·¼í•œ ë§¥ì£¼ì™€ íŽ¸ì•ˆí•œ ë¶„ìœ„ê¸°. ê·¸ë£¹ê³¼ ìž…ë¬¸ìžì—ê²Œ ì¢‹ìŒ.",
      tag5: "ì„¸ë ¨ëœ ì–‘ì¡°ìž¥, ëŒ€ë‹´í•œ ë§¥ì£¼, ìŒì‹, ë£¨í”„íƒ‘. ìˆ˜ìƒ ê²½ë ¥!",
      tag6: "ìºì£¼ì–¼í•˜ê³  ì €ë ´í•œ ê¹”ë”í•œ ìŠ¤íƒ€ì¼. ë¡œì»¬ ë¶„ìœ„ê¸°ì— ë”±.",
      tag7: "ë‹¤ë‚­ì—ì„œ ì‹œìž‘, ì§€ì†ê°€ëŠ¥ì„±ì— ì§‘ì¤‘. í•­ìƒ ìƒˆë¡œìš´ ê²ƒ!",
      tag8: "ì¤‘ì„¸í’ ê³µê°„ì˜ ë²¨ê¸°ì— ìŠ¤íƒ€ì¼ ë§¥ì£¼. í° ìž”ì— ë”±."
    },
    ja: { 
      stamps:"ã‚¹ã‚¿ãƒ³ãƒ—", done:"å®Œäº†!", go:"OK!", code:"ã‚³ãƒ¼ãƒ‰", web:"ã‚¦ã‚§ãƒ–", maps:"åœ°å›³", faq:"FAQ", 
      how:"éŠã³æ–¹", s1:"é†¸é€ æ‰€ã¸è¡Œã", s2:"ãƒ“ãƒ¼ãƒ«è³¼å…¥ã§:", s2a:"QRã‚³ãƒ¼ãƒ‰", s2b:"ã¾ãŸã¯ç§˜å¯†ã‚³ãƒ¼ãƒ‰", 
      s3:"ã‚¹ã‚¿ãƒ³ãƒ—ã‚²ãƒƒãƒˆ!", s4:"8å€‹=ç„¡æ–™å¸½å­!", rush:"ã‚†ã£ãã‚Š!", scan:"QRã‚¹ã‚­ãƒ£ãƒ³", ask:"QRèžã„ã¦!", 
      ok:"OK!", nope:"é•ã†!", copy:"Â© 2024 HCM", copyTag:"ã‚³ãƒ”ãƒ¼", copied:"ã‚³ãƒ”ãƒ¼å®Œäº†!", 
      directions:"é“æ¡ˆå†…", myBeers:"ãƒžã‚¤ãƒ“ãƒ¼ãƒ«", addBeer:"ãƒ“ãƒ¼ãƒ«è¿½åŠ ", beerName:"ãƒ“ãƒ¼ãƒ«å",
      rating:"è©•ä¾¡", notes:"ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰", save:"ä¿å­˜", cancel:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«", noBeer:"è¨˜éŒ²ãªã—",
      complete:"ãŠã‚ã§ã¨ã†!", completeMsg:"Ale Trailå®Œäº†ï¼ç„¡æ–™ã®å¸½å­ã‚’ã‚²ãƒƒãƒˆ:",
      name:"åå‰", email:"ãƒ¡ãƒ¼ãƒ«", phone:"é›»è©±ç•ªå·", submit:"é€ä¿¡", thanks:"ã‚ã‚ŠãŒã¨ã†!",
      collectHat:"ã“ã®ç”»é¢ã‚’è¦‹ã›ã¦å¸½å­ã‚’ã‚‚ã‚‰ãŠã†!", beersAt:"ãƒ“ãƒ¼ãƒ«:",
      welcome:"HCM Ale Trailã¸ã‚ˆã†ã“ãï¼ã‚µã‚¤ã‚´ãƒ³ã®8ã¤ã®ã‚¿ãƒƒãƒ—ãƒ«ãƒ¼ãƒ ã‚’è¨ªã‚Œã¦ã€ãƒ‰ãƒªãƒ³ã‚¯ã‚’è²·ã„ã€ã‚¹ã‚¿ãƒ³ãƒ—ã‚’é›†ã‚ã¦ã€ç„¡æ–™ã®å¸½å­ã‚’ã‚²ãƒƒãƒˆã—ã‚ˆã†ï¼",
      tips:"ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å®ˆã‚‹", tip1:"åŒã˜ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ç”¨ï¼ˆSafariã‹Chromeã©ã¡ã‚‰ã‹ï¼‰", tip2:"ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ä½¿ç”¨ç¦æ­¢", tip3:"å®Œäº†ã¾ã§ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ç¦æ­¢ï¼",
      saveProgress:"é€²æ—ã‚’ä¿å­˜", saveDesc:"å¾©å…ƒãƒªãƒ³ã‚¯ã‚’ãƒ¡ãƒ¼ãƒ«ã§å—ã‘å–ã‚‹", emailPlaceholder:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", sendLink:"ãƒªãƒ³ã‚¯é€ä¿¡", linkSent:"ãƒ¡ãƒ¼ãƒ«ç¢ºèªï¼", linkCopied:"ã‚³ãƒ”ãƒ¼å®Œäº†ï¼",
      tag1: "ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªåå‰ã€å‰µé€ çš„ãªæ–™ç†ã€å…ƒç¥–ã‚¯ãƒ©ãƒ•ãƒˆãƒ“ãƒ¼ãƒ«ã®è–åœ°ã€‚",
      tag2: "å¤§èƒ†ãªãƒ“ãƒ¼ãƒ«ã€å¤§èƒ†ãªãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã€‚IPAã€ã‚¹ã‚¿ã‚¦ãƒˆã€ã‚¤ãƒ³ãƒ‡ã‚£ãƒ¼ãªé›°å›²æ°—ã§æœ‰åã€‚",
      tag3: "ã‚¢ãƒ³ãƒ€ãƒ¼ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãªé›°å›²æ°—ã€ã‚¯ãƒªãƒ¼ãƒ³ãªå°è¦æ¨¡é†¸é€ ã€‚éš ã‚ŒãŸååº—ã€‚",
      tag4: "è¦ªã—ã¿ã‚„ã™ã„ãƒ“ãƒ¼ãƒ«ã¨ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸé›°å›²æ°—ã€‚ã‚°ãƒ«ãƒ¼ãƒ—ã‚„åˆå¿ƒè€…ã«æœ€é©ã€‚",
      tag5: "æ´—ç·´ã•ã‚ŒãŸé†¸é€ æ‰€ã€å¤§èƒ†ãªãƒ“ãƒ¼ãƒ«ã€æ–™ç†ã€å±‹ä¸Šã€‚å—è³žæ­´ã‚ã‚Šï¼",
      tag6: "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã§ãƒªãƒ¼ã‚ºãƒŠãƒ–ãƒ«ã€‚åœ°å…ƒã®é›°å›²æ°—ã«æœ€é©ã€‚",
      tag7: "ãƒ€ãƒŠãƒ³ç”Ÿã¾ã‚Œã€ã‚µã‚¹ãƒ†ãƒŠãƒ“ãƒªãƒ†ã‚£é‡è¦–ã€‚å¸¸ã«æ–°ã—ã„ä½•ã‹ãŒï¼",
      tag8: "ä¸­ä¸–é¢¨ç©ºé–“ã®ãƒ™ãƒ«ã‚®ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«ãƒ“ãƒ¼ãƒ«ã€‚å¤§ããªã‚°ãƒ©ã‚¹ã«æœ€é©ã€‚"
    }
  };
  const t = txt[lang];

  const flags = [
    { c:'en', f:'https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Flag_of_the_United_Kingdom_%283-5%29.svg/1024px-Flag_of_the_United_Kingdom_%283-5%29.svg.png' },
    { c:'vi', f:'https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Flag_of_Vietnam.svg/2560px-Flag_of_Vietnam.svg.png' },
    { c:'ko', f:'https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Flag_of_South_Korea.svg/1200px-Flag_of_South_Korea.svg.png' },
    { c:'ja', f:'https://upload.wikimedia.org/wikipedia/en/thumb/9/9e/Flag_of_Japan.svg/1200px-Flag_of_Japan.svg.png' }
  ];

  const breweries = [
    { id:1, name:"BIACRAFT", dist:"District 3", addr:"1 Le Ngo Cat, District 3", tagKey:"tag1", initials:"BC", color:"#e74c3c", logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSEJ3rjAkeuIS9SXX_AOFpBYyMV8A4uzehpFw&s", mapsUrl:"https://maps.google.com/?q=BiaCraft+Artisan+Ales+1+Le+Ngo+Cat+District+3+Ho+Chi+Minh", ig:"https://www.instagram.com/biacraftartisanales/", fb:"https://facebook.com/biacraft", tags:"#hcmaletrail @biacraftartisanales" },
    { id:2, name:"HEART OF DARKNESS", dist:"District 1", addr:"31D Ly Tu Trong, District 1", tagKey:"tag2", initials:"HD", color:"#2c3e50", logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQhBgGIWX_LhO8HiUMp_ds6FcPwDGJ6zC70nA&s", mapsUrl:"https://maps.google.com/?q=Heart+of+Darkness+Craft+Brewery+31D+Ly+Tu+Trong+District+1+Ho+Chi+Minh", ig:"https://instagram.com/heartofdarknessbrewery", fb:"https://facebook.com/HeartOfDarknessBrewery", tags:"#hcmaletrail @heartofdarknessbrewery" },
    { id:3, name:"DEME", dist:"District 3", addr:"201B Nam Ky Khoi Nghia, District 3", tagKey:"tag3", initials:"DM", color:"#27ae60", logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTUX4bUqOU1mTKfwynaowtTzISSkejiKNGfCQ&s", mapsUrl:"https://maps.google.com/?q=Deme+Brewing+201B+Nam+Ky+Khoi+Nghia+District+3+Ho+Chi+Minh", ig:"https://instagram.com/demebrewing", fb:"https://facebook.com/demebrewing", tags:"#hcmaletrail @demebrewing" },
    { id:4, name:"STEERSMAN", dist:"Tan Binh", addr:"18B Cong Hoa, Tan Binh", tagKey:"tag4", initials:"SM", color:"#3498db", logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSx4fz-XwrRMVL_9VWuMyF2ityGR8FqKICrnQ&s", mapsUrl:"https://maps.google.com/?q=Steersman+Brewery+18B+Cong+Hoa+Tan+Binh+Ho+Chi+Minh", ig:"https://instagram.com/steersmanbrewery", fb:"https://facebook.com/steersmanbrewery", tags:"#hcmaletrail @steersmanbrewery" },
    { id:5, name:"EAST WEST", dist:"District 1", addr:"181-185 Ly Tu Trong, District 1", tagKey:"tag5", initials:"EW", color:"#f39c12", logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRAcbVFo_W36U7i1gPBB7zs72PJg0_nTTqSug&s", mapsUrl:"https://maps.google.com/?q=East+West+Brewing+Co+181+Ly+Tu+Trong+District+1+Ho+Chi+Minh", ig:"https://instagram.com/eastwestbrewing", fb:"https://facebook.com/eastwestbrewery", tags:"#hcmaletrail @eastwestbrewing" },
    { id:6, name:"ROOSTER", dist:"District 1", addr:"31 Ho Huan Nghiep, District 1", tagKey:"tag6", initials:"RB", color:"#e67e22", logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT6zKlPzmE5Vk0yk1X4qJoz5bL5OOd4STZ8SA&s", mapsUrl:"https://maps.google.com/?q=Rooster+Beers+31+Ho+Huan+Nghiep+District+1+Ho+Chi+Minh", ig:"https://instagram.com/roosterbeers", fb:"https://facebook.com/roosterbeers", tags:"#hcmaletrail @roosterbeers" },
    { id:7, name:"7 BRIDGES", dist:"District 1", addr:"25 Ly Tu Trong, District 1", tagKey:"tag7", initials:"7B", color:"#9b59b6", logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSKLaEC86BnuqzhRWUjI9ef1HqIFERkjCgiUg&s", mapsUrl:"https://maps.google.com/?q=7+Bridges+Brewing+25+Ly+Tu+Trong+District+1+Ho+Chi+Minh", ig:"https://instagram.com/7bridgesbrewing", fb:"https://facebook.com/7BridgesBrewingCo", tags:"#hcmaletrail @7bridgesbrewing" },
    { id:8, name:"BELGO", dist:"District 1", addr:"159A Nguyen Van Thu, District 1", tagKey:"tag8", initials:"BG", color:"#c0392b", logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSYUWfQCHCQqNFx-EXnsiRLKZUSW5_P2f34mQ&s", mapsUrl:"https://maps.google.com/?q=Belgo+Belgian+Craft+Beer+159A+Nguyen+Van+Thu+District+1+Ho+Chi+Minh", ig:"https://instagram.com/belgosaigon", fb:"https://facebook.com/belgosaigon", tags:"#hcmaletrail @belgosaigon" }
  ];

  const getTagline = (brewery) => t[brewery.tagKey];

  // Send data to Google Sheets
  const sendToSheets = async (data) => {
    if (!GOOGLE_SHEETS_URL || GOOGLE_SHEETS_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
      console.log('Google Sheets not configured. Data:', data);
      return;
    }
    // Add client-side timestamp
    const dataWithTime = {
      ...data,
      clientTime: new Date().toISOString(),
      localTime: new Date().toLocaleString('en-US', { timeZone: 'Asia/Ho_Chi_Minh' })
    };
    try {
      await fetch(GOOGLE_SHEETS_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dataWithTime)
      });
      console.log('Sent to Google Sheets:', dataWithTime);
    } catch (err) {
      console.log('Sheet error:', err);
    }
  };

  const validate = () => {
    if (codes[selected.id] === code.toUpperCase().trim()) {
      const newStamps = [...stamps, selected.id];
      setStamps(newStamps);
      setCode(''); setError('');
      // Log stamp collection to Google Sheets
      sendToSheets({
        type: 'stamp',
        brewery: selected.name,
        breweryId: selected.id,
        method: 'CODE',
        stampCount: newStamps.length
      });
      // Check if completed
      if (newStamps.length === 8 && !userInfo?.completed) {
        setTimeout(() => {
          setSelected(null);
          setShowCompletion(true);
        }, 1000);
      }
    } else setError(t.nope);
  };

  const copyTags = (tags) => {
    navigator.clipboard.writeText(tags).then(() => {
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    });
  };

  const saveBeer = () => {
    if (!beerName.trim() || beerRating === 0) return;
    const newBeer = {
      id: Date.now(),
      breweryId: selected.id,
      breweryName: selected.name,
      name: beerName,
      rating: beerRating,
      notes: beerNotes,
      date: new Date().toISOString()
    };
    setBeerLogs([...beerLogs, newBeer]);
    // Send to Google Sheets
    sendToSheets({
      type: 'beer',
      brewery: selected.name,
      beerName: beerName,
      rating: beerRating,
      notes: beerNotes,
      userName: userInfo?.name || ''
    });
    setBeerName(''); setBeerRating(0); setBeerNotes('');
    setShowBeerLog(false);
  };

  const submitCompletion = () => {
    if (!completionName.trim() || !completionEmail.trim()) return;
    const info = {
      name: completionName,
      email: completionEmail,
      phone: completionPhone,
      finalBrewery: selected?.name || 'Unknown',
      completed: true,
      completedAt: new Date().toISOString()
    };
    setUserInfo(info);
    // Send to Google Sheets
    sendToSheets({
      type: 'completion',
      name: completionName,
      email: completionEmail,
      phone: completionPhone,
      finalBrewery: selected?.name || 'Unknown'
    });
    setCompletionSubmitted(true);
  };

  const prog = (stamps.length / 8) * 100;
  const beersAtBrewery = (id) => beerLogs.filter(b => b.breweryId === id);

  // Generate recovery URL with encoded data
  const generateRecoveryUrl = () => {
    const data = { stamps, beerLogs, userInfo };
    const encoded = btoa(JSON.stringify(data));
    return window.location.origin + window.location.pathname + '?recover=' + encoded;
  };

  // Send recovery link via email
  const sendRecoveryEmail = () => {
    if (!saveEmail.trim()) return;
    const recoveryUrl = generateRecoveryUrl();
    const subject = 'HCM Ale Trail - Your Progress Recovery Link';
    const body = `Here's your HCM Ale Trail recovery link!\n\nYou have ${stamps.length}/8 stamps collected.\n\nClick this link to restore your progress:\n${recoveryUrl}\n\nKeep this email safe until you complete the trail! ðŸº`;
    window.open('mailto:' + saveEmail + '?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body));
    setSaveSent(true);
    setTimeout(() => { setSaveSent(false); setShowSaveProgress(false); setSaveEmail(''); }, 3000);
  };

  // Copy recovery link
  const copyRecoveryLink = () => {
    navigator.clipboard.writeText(generateRecoveryUrl()).then(() => {
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    });
  };

  // Restore from recovery URL
  useEffect(() => {
    const params = new URLSearchParams(window.location.search);
    const recoverData = params.get('recover');
    if (recoverData) {
      try {
        const data = JSON.parse(atob(recoverData));
        if (data.stamps && Array.isArray(data.stamps)) {
          setStamps(data.stamps);
        }
        if (data.beerLogs && Array.isArray(data.beerLogs)) {
          setBeerLogs(data.beerLogs);
        }
        if (data.userInfo) {
          setUserInfo(data.userInfo);
        }
        window.history.replaceState({}, '', window.location.pathname);
        alert('Progress restored! You have ' + (data.stamps?.length || 0) + '/8 stamps.');
      } catch (err) {
        console.log('Recovery error:', err);
      }
    }
  }, []);

  // FLAGS
  const flagBtns = flags.map(f => 
    e('button', { key:f.c, onClick:()=>setLang(f.c), className:`${lang===f.c?'ring-4 ring-yellow-400 scale-110':'opacity-50'} w-16 h-10 border-2 border-black overflow-hidden transition-all` },
      e('img', { src:f.f, className:'w-full h-full object-cover' })
    )
  );

  // BREWERY LIST WITH LOGOS
  const breweryList = breweries.map(b => {
    const has = stamps.includes(b.id);
    const beerCount = beersAtBrewery(b.id).length;
    return e('div', { key:b.id, onClick:()=>setSelected(b), className:`${has?'bg-yellow-400':'bg-white'} border-4 border-black cursor-pointer active:scale-[0.98] transition-all` },
      e('div', { className:'flex items-center h-24' },
        e('div', { className:`${has?'bg-green-600':'bg-red-600'} w-16 h-full flex items-center justify-center flex-shrink-0 relative` },
          e('span', { className:'text-4xl text-yellow-400', style:block }, b.id),
          beerCount > 0 && e('div', { className:'absolute top-1 right-1 bg-orange-500 rounded-full w-5 h-5 flex items-center justify-center' },
            e('span', { className:'text-white text-xs font-bold' }, beerCount)
          )
        ),
        e('div', { className:'flex-1 px-2 py-1 flex flex-col justify-center min-w-0' },
          e('h3', { className:'text-xl sm:text-2xl md:text-3xl text-red-600 truncate', style:breweryBlock }, b.name),
          e('p', { className:'text-sm sm:text-base text-red-500', style:block }, b.dist)
        ),
        e('div', { className:'w-20 h-full flex items-center justify-center border-l-4 border-black border-dashed flex-shrink-0' },
          e('div', { 
            className:`w-16 h-16 rounded-full overflow-hidden border-3 ${has?'border-green-500':'border-gray-400'} bg-white flex items-center justify-center relative`
          },
            e('img', { 
              src: b.logo, 
              alt: b.name,
              className: `w-full h-full object-cover ${has ? '' : 'opacity-40 grayscale'}`,
              style: { display: 'block' }
            }),
            has && e('div', { className:'absolute bottom-0 right-0 bg-green-500 rounded-full w-5 h-5 flex items-center justify-center border border-white' },
              e('span', { className:'text-white text-xs font-bold' }, 'âœ“')
            )
          )
        )
      )
    );
  });

  // STAR RATING COMPONENT
  const StarRating = ({value, onChange}) => e('div', { className:'flex gap-1 justify-center' },
    [1,2,3,4,5].map(i => 
      e('button', { key:i, type:'button', onClick:()=>onChange(i), className:`${i <= value ? 'text-orange-500' : 'text-gray-300'} hover:scale-110 transition-all` },
        e(Star, { size:36, filled: i <= value })
      )
    )
  );

  // FAQ MODAL
  const faqModal = showFaq && e('div', { className:'fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4' },
    e('div', { className:'bg-yellow-400 w-full max-w-sm border-4 border-black relative max-h-[85vh] overflow-y-auto' },
      e('button', { onClick:()=>setShowFaq(false), className:'absolute top-2 right-2 bg-red-600 text-yellow-400 w-10 h-10 flex items-center justify-center border-4 border-black text-2xl z-10', style:block }, 'X'),
      e('div', { className:'p-3 pt-10' },
        e('h2', { className:'text-3xl text-center text-red-600 mb-3', style:block }, t.how),
        e('div', { className:'space-y-2' },
          e('div', { className:'bg-red-600 border-2 border-black p-2 flex items-center gap-2' }, e('span',{className:'text-3xl text-yellow-400 w-10',style:block},'1'), e('span',{className:'text-lg text-yellow-400 flex-1',style:block},t.s1)),
          e('div', { className:'bg-red-600 border-2 border-black p-2 flex items-center gap-2' }, e('span',{className:'text-3xl text-yellow-400 w-10',style:block},'2'), e('div',{className:'flex-1'}, e('span',{className:'text-lg text-yellow-400 block',style:block},t.s2), e('span',{className:'text-sm text-yellow-300',style:block},t.s2a+' / '+t.s2b))),
          e('div', { className:'bg-red-600 border-2 border-black p-2 flex items-center gap-2' }, e('span',{className:'text-3xl text-yellow-400 w-10',style:block},'3'), e('span',{className:'text-lg text-yellow-400 flex-1',style:block},t.s3)),
          e('div', { className:'bg-green-600 border-2 border-black p-2 flex items-center gap-2' }, e('span',{className:'text-3xl text-white w-10',style:block},'4'), e('span',{className:'text-lg text-white flex-1',style:block},t.s4))
        ),
        e('div', { className:'bg-black border-2 border-yellow-400 p-2 mt-2' }, e('p',{className:'text-xl text-yellow-400 text-center',style:block},t.rush)),
        // TIPS SECTION
        e('div', { className:'bg-white border-2 border-black p-3 mt-3' },
          e('p', { className:'text-lg text-red-600 font-bold mb-2', style:block }, 'ðŸ’¡ '+t.tips),
          e('ul', { className:'text-sm text-gray-700 space-y-1' },
            e('li', null, 'â€¢ '+t.tip1),
            e('li', null, 'â€¢ '+t.tip2),
            e('li', null, 'â€¢ '+t.tip3)
          )
        ),
        e('button', { onClick:()=>setShowFaq(false), className:'w-full bg-red-600 text-yellow-400 py-3 mt-2 text-3xl border-4 border-black', style:block }, t.ok)
      )
    )
  );

  // QR MODAL
  const qrModal = showQR && e('div', { className:'fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4' },
    e('div', { className:'bg-yellow-400 w-full max-w-sm border-4 border-black relative' },
      e('button', { onClick:()=>setShowQR(false), className:'absolute top-2 right-2 bg-red-600 text-yellow-400 w-10 h-10 flex items-center justify-center border-4 border-black text-2xl z-10', style:block }, 'X'),
      e('div', { className:'p-3 pt-10' },
        e('div', { className:'bg-white border-4 border-black p-4 mb-2 text-center' }, e('div',{className:'text-6xl'},'ðŸ“±'), e('p',{className:'text-2xl text-black mt-2',style:block},t.ask)),
        e('div', { className:'bg-red-600 border-2 border-black p-3 mb-2' },
          e('p',{className:'text-lg text-yellow-400',style:block},'â€¢ iPHONE â†’ CAMERA'),
          e('p',{className:'text-lg text-yellow-400',style:block},'â€¢ ANDROID â†’ LENS'),
          e('p',{className:'text-lg text-yellow-400',style:block},'â€¢ POINT â†’ TAP â†’ DONE!')
        ),
        e('button', { onClick:()=>setShowQR(false), className:'w-full bg-green-600 text-white py-4 text-3xl border-4 border-black', style:block }, t.ok)
      )
    )
  );

  // SAVE PROGRESS MODAL
  const saveProgressModal = showSaveProgress && e('div', { className:'fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4' },
    e('div', { className:'bg-yellow-400 w-full max-w-sm border-4 border-black relative' },
      e('button', { onClick:()=>{setShowSaveProgress(false);setSaveEmail('');setSaveSent(false);}, className:'absolute top-2 right-2 bg-red-600 text-yellow-400 w-10 h-10 flex items-center justify-center border-4 border-black text-2xl z-10', style:block }, 'X'),
      e('div', { className:'p-3 pt-10' },
        e('h2', { className:'text-2xl text-center text-red-600 mb-2', style:block }, 'ðŸ’¾ '+t.saveProgress),
        e('p', { className:'text-center text-red-700 mb-3 text-sm' }, t.saveDesc),
        e('div', { className:'bg-white border-4 border-black p-3 mb-3 text-center' },
          e('p', { className:'text-lg font-bold text-green-600' }, stamps.length + '/8 ' + t.stamps),
          e('p', { className:'text-sm text-gray-600' }, beerLogs.length + ' ' + t.myBeers.toLowerCase())
        ),
        saveSent ? 
          e('div', { className:'bg-green-600 border-4 border-black p-4 text-center' },
            e('p', { className:'text-2xl text-white', style:block }, 'âœ… ' + t.linkSent)
          ) :
          e('div', { className:'space-y-2' },
            e('input', { 
              type:'email', 
              value:saveEmail, 
              onChange:ev=>setSaveEmail(ev.target.value), 
              className:'w-full px-3 py-3 border-4 border-black text-lg text-center', 
              placeholder:t.emailPlaceholder 
            }),
            e('button', { 
              onClick:sendRecoveryEmail, 
              disabled:!saveEmail.trim(), 
              className:`w-full ${saveEmail.trim()?'bg-green-600':'bg-gray-400'} text-white py-3 text-xl border-4 border-black`, 
              style:block 
            }, 'ðŸ“§ '+t.sendLink),
            e('div', { className:'text-center text-red-600 font-bold my-2' }, 'â€” OR â€”'),
            e('button', { 
              onClick:copyRecoveryLink, 
              className:`w-full ${copied?'bg-green-600':'bg-blue-600'} text-white py-3 text-xl border-4 border-black`, 
              style:block 
            }, copied ? 'âœ… '+t.linkCopied : 'ðŸ“‹ COPY LINK')
          )
      )
    )
  );

  // BEER LOG MODAL
  const beerLogModal = showBeerLog && e('div', { className:'fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4' },
    e('div', { className:'bg-yellow-400 w-full max-w-sm border-4 border-black relative' },
      e('button', { onClick:()=>{setShowBeerLog(false);setBeerName('');setBeerRating(0);setBeerNotes('');}, className:'absolute top-2 right-2 bg-red-600 text-yellow-400 w-10 h-10 flex items-center justify-center border-4 border-black text-2xl z-10', style:block }, 'X'),
      e('div', { className:'p-3 pt-10' },
        e('h2', { className:'text-2xl text-center text-red-600 mb-3', style:block }, 'ðŸº '+t.addBeer),
        e('p', { className:'text-center text-red-700 mb-2 font-bold' }, selected?.name),
        e('div', { className:'space-y-3' },
          e('div', null,
            e('label', { className:'text-red-600 text-sm font-bold' }, t.beerName),
            e('input', { type:'text', value:beerName, onChange:ev=>setBeerName(ev.target.value), className:'w-full px-3 py-2 border-4 border-black text-lg', placeholder:'e.g. Saigon Blonde' })
          ),
          e('div', null,
            e('label', { className:'text-red-600 text-sm font-bold block mb-1' }, t.rating),
            e(StarRating, { value:beerRating, onChange:setBeerRating })
          ),
          e('div', null,
            e('label', { className:'text-red-600 text-sm font-bold' }, t.notes),
            e('textarea', { value:beerNotes, onChange:ev=>setBeerNotes(ev.target.value), className:'w-full px-3 py-2 border-4 border-black text-sm', rows:2, placeholder:'Tasting notes...' })
          ),
          e('div', { className:'flex gap-2' },
            e('button', { onClick:()=>{setShowBeerLog(false);setBeerName('');setBeerRating(0);setBeerNotes('');}, className:'flex-1 bg-gray-500 text-white py-3 text-xl border-4 border-black', style:block }, t.cancel),
            e('button', { onClick:saveBeer, disabled:!beerName.trim()||beerRating===0, className:`flex-1 ${beerName.trim()&&beerRating>0?'bg-green-600':'bg-gray-400'} text-white py-3 text-xl border-4 border-black`, style:block }, t.save)
          )
        )
      )
    )
  );

  // MY BEERS MODAL
  const myBeersModal = showMyBeers && e('div', { className:'fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4' },
    e('div', { className:'bg-yellow-400 w-full max-w-sm border-4 border-black relative max-h-[80vh] overflow-y-auto' },
      e('button', { onClick:()=>setShowMyBeers(false), className:'absolute top-2 right-2 bg-red-600 text-yellow-400 w-10 h-10 flex items-center justify-center border-4 border-black text-2xl z-10', style:block }, 'X'),
      e('div', { className:'p-3 pt-10' },
        e('h2', { className:'text-2xl text-center text-red-600 mb-3', style:block }, 'ðŸº '+t.myBeers+' ('+beerLogs.length+')'),
        beerLogs.length === 0 ? 
          e('p', { className:'text-center text-red-700 py-4' }, t.noBeer) :
          e('div', { className:'space-y-2' },
            beerLogs.slice().reverse().map(beer => 
              e('div', { key:beer.id, className:'bg-white border-2 border-black p-2' },
                e('div', { className:'flex justify-between items-start' },
                  e('div', null,
                    e('p', { className:'font-bold text-red-600' }, beer.name),
                    e('p', { className:'text-xs text-gray-600' }, beer.breweryName)
                  ),
                  e('div', { className:'flex text-orange-500' },
                    [1,2,3,4,5].map(i => e(Star, { key:i, size:12, filled:i<=beer.rating }))
                  )
                ),
                beer.notes && e('p', { className:'text-xs text-gray-500 mt-1 italic' }, beer.notes)
              )
            )
          )
      )
    )
  );

  // COMPLETION MODAL
  const completionModal = showCompletion && e('div', { className:'fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4' },
    e('div', { className:'bg-yellow-400 w-full max-w-sm border-4 border-black relative' },
      !completionSubmitted && e('button', { onClick:()=>setShowCompletion(false), className:'absolute top-2 right-2 bg-red-600 text-yellow-400 w-10 h-10 flex items-center justify-center border-4 border-black text-2xl z-10', style:block }, 'X'),
      e('div', { className:'p-4' },
        e('div', { className:'text-6xl text-center mb-2' }, 'ðŸŽ‰ðŸºðŸŽ‰'),
        e('h2', { className:'text-3xl text-center text-red-600 mb-2', style:block }, t.complete),
        completionSubmitted ? 
          e('div', { className:'text-center' },
            e('div', { className:'bg-green-600 border-4 border-black p-4 mb-3' },
              e('p', { className:'text-2xl text-white', style:block }, t.thanks),
              e('p', { className:'text-lg text-yellow-300 mt-2' }, t.collectHat)
            ),
            e('div', { className:'bg-white border-4 border-black p-3' },
              e('p', { className:'font-bold' }, userInfo?.name),
              e('p', { className:'text-sm text-gray-600' }, userInfo?.email),
              e('p', { className:'text-sm text-green-600 mt-2' }, 'âœ… 8/8 STAMPS COLLECTED')
            ),
            e('button', { onClick:()=>setShowCompletion(false), className:'w-full bg-red-600 text-yellow-400 py-3 mt-3 text-2xl border-4 border-black', style:block }, t.ok)
          ) :
          e('div', null,
            e('p', { className:'text-center text-red-700 mb-3' }, t.completeMsg),
            e('div', { className:'space-y-2' },
              e('div', null,
                e('label', { className:'text-red-600 text-sm font-bold' }, t.name+' *'),
                e('input', { type:'text', value:completionName, onChange:ev=>setCompletionName(ev.target.value), className:'w-full px-3 py-2 border-4 border-black text-lg' })
              ),
              e('div', null,
                e('label', { className:'text-red-600 text-sm font-bold' }, t.email+' *'),
                e('input', { type:'email', value:completionEmail, onChange:ev=>setCompletionEmail(ev.target.value), className:'w-full px-3 py-2 border-4 border-black text-lg' })
              ),
              e('div', null,
                e('label', { className:'text-red-600 text-sm font-bold' }, t.phone),
                e('input', { type:'tel', value:completionPhone, onChange:ev=>setCompletionPhone(ev.target.value), className:'w-full px-3 py-2 border-4 border-black text-lg' })
              ),
              e('button', { onClick:submitCompletion, disabled:!completionName.trim()||!completionEmail.trim(), className:`w-full ${completionName.trim()&&completionEmail.trim()?'bg-green-600':'bg-gray-400'} text-white py-4 mt-2 text-2xl border-4 border-black`, style:block }, t.submit)
            )
          )
      )
    )
  );

  // BREWERY MODAL WITH BEER LOGGING
  const breweryModal = selected && !showCompletion && e('div', { className:'fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-2' },
    e('div', { className:'bg-yellow-400 w-full max-w-sm border-4 border-black relative max-h-[90vh] overflow-y-auto' },
      e('button', { onClick:()=>{setSelected(null);setCode('');setError('');setCopied(false);setAutoStamped(false);}, className:'absolute top-2 right-2 bg-red-600 text-yellow-400 w-10 h-10 flex items-center justify-center border-4 border-black text-2xl z-10', style:block }, 'X'),
      e('div', { className:'p-3 pt-12' },
        autoStamped && stamps.includes(selected.id) && e('div', { className:'bg-green-600 border-4 border-black p-3 mb-2 text-center' },
          e('p', { className:'text-2xl text-white', style:block }, 'ðŸŽ‰ STAMP COLLECTED!')
        ),
        e('button', { onClick:()=>setShowQR(true), className:'w-full bg-white border-4 border-red-600 p-3 mb-2 active:scale-95 transition-all' },
          e('div',{className:'text-5xl text-center'},'ðŸ“±'),
          e('p',{className:'text-2xl text-red-600 text-center',style:block},t.scan)
        ),
        e('div', { className:'bg-red-600 border-4 border-black p-3 mb-2' },
          e('h2',{className:'text-2xl sm:text-3xl text-yellow-400 text-center',style:breweryBlock},selected.name),
          e('p',{className:'text-sm text-yellow-300 mt-1 text-center'},'ðŸ“ '+selected.addr),
          e('p',{className:'text-xs text-yellow-200 mt-2 text-center italic'},getTagline(selected))
        ),
        // GOOGLE MAPS DIRECTIONS BUTTON
        e('a', { 
          href:selected.mapsUrl, 
          target:'_blank', 
          rel:'noopener noreferrer', 
          className:'w-full bg-green-600 text-white py-3 mb-2 text-xl border-4 border-black flex items-center justify-center gap-2 active:scale-95 transition-all', 
          style:block 
        }, e(MapPin,{size:24}), t.directions),
        // ADD BEER BUTTON
        e('button', { 
          onClick:()=>setShowBeerLog(true), 
          className:'w-full bg-orange-500 text-white py-3 mb-2 text-xl border-4 border-black flex items-center justify-center gap-2 active:scale-95 transition-all', 
          style:block 
        }, e(Beer,{size:24}), t.addBeer),
        // Show beers logged at this brewery
        beersAtBrewery(selected.id).length > 0 && e('div', { className:'bg-white border-2 border-black p-2 mb-2' },
          e('p', { className:'text-sm font-bold text-red-600 mb-1' }, t.beersAt+' '+selected.name+':'),
          beersAtBrewery(selected.id).map(beer => 
            e('div', { key:beer.id, className:'flex justify-between items-center text-sm py-1 border-b border-gray-200 last:border-0' },
              e('span', null, beer.name),
              e('span', { className:'flex text-orange-500' }, [1,2,3,4,5].map(i => e(Star,{key:i,size:10,filled:i<=beer.rating})))
            )
          )
        ),
        // Social buttons
        e('div', { className:'flex gap-2 mb-2' },
          e('a', { href:selected.ig, target:'_blank', rel:'noopener noreferrer', className:'flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 text-xl border-2 border-black flex items-center justify-center gap-1 active:scale-95 transition-all', style:block }, e(Instagram,{size:20}), 'IG'),
          e('a', { href:selected.fb, target:'_blank', rel:'noopener noreferrer', className:'flex-1 bg-blue-600 text-white py-3 text-xl border-2 border-black flex items-center justify-center gap-1 active:scale-95 transition-all', style:block }, e(Facebook,{size:20}), 'FB')
        ),
        // Copy tags with translated button
        e('div', { className:'bg-black border-2 border-yellow-400 p-2 mb-2' },
          e('p',{className:'text-xs text-yellow-400 text-center mb-1 font-mono'},selected.tags),
          e('button', { onClick:()=>copyTags(selected.tags), className:`w-full ${copied?'bg-green-600 text-white':'bg-yellow-400 text-black'} py-2 text-lg border-2 border-black flex items-center justify-center gap-1 active:scale-95 transition-all`, style:block }, e(Copy,{size:18}), copied?t.copied:t.copyTag)
        ),
        // Code entry or validated
        !stamps.includes(selected.id) ? 
          e('div', null,
            e('p',{className:'text-2xl text-red-600 text-center mb-1',style:block},'â€” '+t.code+' â€”'),
            e('input', { type:'password', value:code, onChange:ev=>{setCode(ev.target.value);setError('');}, onKeyPress:ev=>{if(ev.key==='Enter')validate();}, className:'w-full px-3 py-3 text-2xl text-center uppercase border-4 border-black mb-1 bg-black text-yellow-400', style:{...block,letterSpacing:'6px'}, placeholder:'****', maxLength:'20' }),
            error && e('p',{className:'text-center text-xl text-red-600 mb-1',style:block},'âŒ '+error),
            e('button', { onClick:validate, className:'w-full bg-green-600 text-white py-4 text-3xl border-4 border-black active:scale-95 transition-all', style:block }, t.go)
          ) :
          e('div', { className:'bg-green-600 border-4 border-black p-4 text-center' },
            e('div',{
              className:'w-20 h-20 mx-auto rounded-full overflow-hidden border-2 border-white bg-white flex items-center justify-center mb-2'
            },
              e('img', { src: selected.logo, alt: selected.name, className:'w-full h-full object-cover' })
            ),
            e('p',{className:'text-3xl text-white',style:block},t.done)
          )
      )
    )
  );

  return e('div', { className:'min-h-screen bg-red-600 p-2' },
    e('div', { className:'max-w-md mx-auto' },
      e('div', { className:'flex justify-center gap-1 mb-2' }, flagBtns),
      e('div', { className:'bg-yellow-400 border-4 border-black p-2 mb-2 text-center' },
        e('h1', { className:'text-3xl sm:text-4xl md:text-5xl text-red-600 leading-none', style:{...block,letterSpacing:'2px'} }, 'HCM ALE TRAIL'),
        e('p', { className:'text-xs text-red-700 mt-2 px-2 leading-relaxed', style:{fontFamily:'sans-serif', fontWeight:'normal', textTransform:'none', letterSpacing:'0.3px'} }, t.welcome)
      ),
      e('div', { className:'bg-black border-4 border-yellow-400 p-2 mb-2' },
        e('div', { className:'flex items-center justify-between' },
          e('span', { className:'text-2xl sm:text-3xl text-yellow-400', style:block }, t.stamps),
          e('span', { className:'text-3xl sm:text-4xl text-yellow-400', style:block }, stamps.length+'/8')
        ),
        e('div', { className:'h-3 bg-red-900 border border-yellow-400 mt-1' },
          e('div', { className:'h-full bg-green-500 transition-all', style:{width:prog+'%'} })
        ),
        stamps.length > 0 && e('button', { onClick:()=>setShowSaveProgress(true), className:'w-full bg-blue-600 text-white py-2 mt-2 text-sm border-2 border-yellow-400 flex items-center justify-center gap-1', style:block }, 'ðŸ’¾ '+t.saveProgress),
        stamps.length === 8 && !userInfo?.completed && e('button', { onClick:()=>setShowCompletion(true), className:'w-full bg-green-600 text-white py-2 mt-2 text-lg border-2 border-yellow-400 animate-pulse', style:block }, 'ðŸŽ‰ '+t.complete+' '+t.submit+'!')
      ),
      e('div', { className:'grid grid-cols-4 gap-1 mb-1' },
        e('button', { onClick:()=>setShowFaq(true), className:'bg-yellow-400 text-red-600 py-2 text-sm border-4 border-black active:scale-95 transition-all', style:block }, t.faq),
        e('a', { href:links.website, target:'_blank', rel:'noopener noreferrer', className:'bg-black text-yellow-400 py-2 text-sm border-4 border-yellow-400 active:scale-95 transition-all text-center flex items-center justify-center', style:block }, t.web),
        e('a', { href:links.maps, target:'_blank', rel:'noopener noreferrer', className:'bg-green-600 text-white py-2 text-sm border-4 border-black active:scale-95 transition-all text-center flex items-center justify-center', style:block }, t.maps),
        e('button', { onClick:()=>setShowMyBeers(true), className:'bg-orange-500 text-white py-2 text-xs border-4 border-black active:scale-95 transition-all relative flex items-center justify-center gap-1', style:block }, 
          t.myBeers,
          beerLogs.length > 0 && e('span', { className:'absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center' }, beerLogs.length)
        )
      ),
      e('div', { className:'grid grid-cols-2 gap-1 mb-2' },
        e('a', { href:links.ig, target:'_blank', rel:'noopener noreferrer', className:'bg-gradient-to-r from-purple-600 via-pink-600 to-orange-500 text-white py-2 text-sm border-4 border-black active:scale-95 transition-all text-center flex items-center justify-center gap-1', style:block }, e(Instagram,{size:18}), 'INSTAGRAM'),
        e('a', { href:links.msg, target:'_blank', rel:'noopener noreferrer', className:'bg-blue-500 text-white py-2 text-sm border-4 border-black active:scale-95 transition-all text-center flex items-center justify-center gap-1', style:block }, e(Messenger,{size:18}), 'MESSENGER')
      ),
      e('div', { className:'space-y-1' }, breweryList),
      e('div', { className:'mt-2 text-center' }, e('p',{className:'text-lg text-yellow-400',style:block},t.copy))
    ),
    faqModal,
    qrModal,
    saveProgressModal,
    beerLogModal,
    myBeersModal,
    completionModal,
    breweryModal
  );
}

ReactDOM.render(e(App), document.getElementById('root'));
    </script>
</body>
</html>
